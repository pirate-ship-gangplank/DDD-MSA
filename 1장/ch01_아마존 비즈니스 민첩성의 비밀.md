# ch01_아마존 비즈니스 민첩성의 비밀

## 1.1 성공한 인터넷 기업들과 비즈니스 민첩성

아마존, 넷플릭스, 우버 등 성공적인 유니콘 기업의 공통점
* 익숙한 비즈니스에 새로운 비즈니스 개념과 기술을 융합해 자신만의 특화된 서비스를 제공
* 사용자의 피드백을 끊임없이 반영하는 비즈니스 민첩성(Agility)

아마존 비즈니스 서비스 배포속도
* 2011년 11.6초
* 2019년 0.66초

일반 비즈니스 서비스(기획, 분석, 설계 구현 과정을 거쳐 빌드, 배포)
* 수주 ~ 수개월 소요

아마존은 이 과정이 독립적으로 완료되어 초당 1.5번씩 서비스 개선하고 끊임없이 진화함

**결과적으로 빠른 배포 주기는 비즈니스 민첩성의 간접적 지표(서비스 오픈, 개선, 폐기 등)**

독립적인 서비스 배포는 시스템 인프라에도 반영

클라우드 이전에는 서버 도입, 네트워크 구축, 운영체제 설치, 소프트웨어 설치 등 수주 ~ 수개월이 필요하며 이에 따른 비용 부담이 큼

클라우드 인프라가 도입되면서 서비스 개발에 필요한 시스템 인프라 준비 시 사용량에 따른 비용 절감 및 준비 시간 단축(사용한 단위만큼 비용을 지불 및 클릭 몇번으로 구축 가능)

인프라 용량의 성능과 가용성을 높이는 방법
* 스케일 업 : 물리적 용량을 증가시키는 방법(Clock, Memory 등)으로 사용량이 많아진다면 그것을 처리할 그릇도 커야함
* 스케일 아웃 : 다수의 장비를 병행 추가하는 방법으로 사용량 분산을 통한 장애 해결

시스템 운영자 입장에서 서비스를 단일로 개발하지 않고 분할하여 운영하면 효율적으로 확장 가능
=> 독립 서비스(ex. 타임세일 서비스)의 예측 사용량이 많다면 스케일업 시키고, 트래픽 증가 시 해당 인스턴스만 스케일 아웃 형식으로 운영

이는 곧 **클라우드 인프라도 결국 비즈니스 개발 민첩성 향상에 영향이 크다**는 것을 알 수 있음

클라우드 환경에 하나의 큰 덩어리로 올라갈 수 있게 만든 애플리케이션은 **클라우드 프렌들리 애플리케이션**
독립적으로 분리되어 배포될 수 있는 조각으로 구성된 애플리케이션은 **클라우드 네이티브 애플리케이션**

비즈니스 민첩성을 잘 지원하기 위해서는 **클라우드 네이티브 애플리케이션**이 가장 효과적임


## 1.2 마이크로서비스란 무엇인가?

시스템 구조는 **모노리스(monolith)** 와 **마이크로서비스** 가 있음
* 모노리스는 3티어 구조 형식으로 클라이언트-모노리스-데이터베이스 형식으로 구성됨
* 마이크로서비스는 서비스 앞에 로드 밸런서를 두고 여러 인스턴스 위에 큰 덩어리를 복제해 수평 확장

모노리스는 결국 스케일 아웃 시 전체가 확장해야 하고, 작은 변화도 서비스 전체가 배포되어야 하고, 데이터베이스도 하나이므로 탄력적으로 대응 불가
마이크로서비스 시스템은 서버 측이 여러 조각으로 구성되어 이 인스턴스들이 모여 하나의 비즈니스 애플리케이션을 구성하므로 독립적 확장 가능하며 서비스 별 다른 언어로 개발 가능

소프트웨어 공학에서의 모듈화 개념 발전 흐름
* 구조적(structured) 방법론: 단순히 기능을 하향식 분해해서 설계해 나가는 구조
* 객체지향(object-oriented) 방법론: 객체 단위로 모듈화
* CBD(Component Based Development): 모듈화의 단위가 기능별로 재사용할 수 있는 좀 더 큰 컴포넌트
* SOA(Service Oriented Architecture)컴포넌트를 모아 비즈니스적으로 의미 있고 완결적인 서비스 단위로 모듈화

마이크로서비스 아키텍처(MSA: Microservice Architecture): 마이크로서비스 기반으로 시스템 개발하는 아키텍처 및 개발방식

SOA는 구체적이지 않고 이론적이라 성공을 증명하지 못했지만, MSA는 클라우드 인프라의 등장을 통해 성공적으로 증명된 시스템 구조임(넷플릭스, 아마존 등)

MSA는 API형식으로 느슨하게 연계하고 각 독립적인 서비스 별로 배포되어 서비스에 대한 중앙 집중적인 관리는 최소화 되고, 서로 다른 언어, 데이터, 저장 기술을 사용할 수 있음.
(언어와 저장소를 자율적으로 선택할 수 있는 방식을 가리켜 '폴리글랏(Polyglot)하다'라고 표현함)

MSA 모듈화 방식
1. 서비스별 저장소 분리를 통해 다른 서비스가 저장소를 직접 호출하지 못하도록 캡슐화(오로지 API접근만 허용)
2. REST API같은 가벼운 개방형 표준을 통해 각 서비스가 느슨하게 연계되고 누구나 쉽게 사용 가능


## 1.3 마이크로서비스를 위한 조건은 무엇인가?

### 1.3.1 조직의 변화: 업무 기능 중심 팀
기존 업무 방식은 하나의 애플리케이션을 위해 UI팀, 서버개발팀, DB팀으로 분리되어 팀간 의사소통이 필요
(팀간 의사결정이 매우 느림)

마이크로서비스팀에서는 업무 기능 중심 팀으로 기술이 다양한 사람들이 하나의 팀을 이루어 서비스 개발(다기능팀)
-> 타 부서간 협업이 아닌 내부적으로 필요한 기능과 기술을 가지고 있어 내부 의사소통으로 해결 가능

### 1.3.2 관리체계의 변화: 자율적인 분권 거버넌스, 폴리글랏
다기능 팀이 개발, 운영을 책임지기에 각 마이크로서비스 팀에서 독립적 서비스를 위한 최적의 언어와 저장소를 자유롭게 선택 가능하기에 이를 각각 폴리글랏 프로그래밍, 폴리글랏 저장소라고 한다.

### 1.3.3 개발 생명주기의 변화: 프로젝트가 아니라 제품 중심으로
프로젝트 단위 개발 모델은 초기에 모든 일정을 계획하기에 기간중 발생한 변경이나 새로운 아이디어를 포용하지 못함
마이크로서비스팀의 개발은 비즈니스를 제공하는 제품(product)으로 보고 개발 뒤 반응을 보고 개선하는 과정을 점진적으로 반복하는 애자일(agile) 방식을 채용
-> 약 2~3주 단위로 스프린트(Sprint)를 통해 개발 배포, 피드백을 받아 반영(요구사항에 따른 지속적 개선)

**마이크로서비스는 계속 피드백을 받아 지속적으로 변화, 개선되고 향상되는 존재**

### 1.3.4 개발 환경의 변화: 인프라 자동화
마이크로서비스는 독립적으로 배포되기에 여러 서비스를 빠르게 배포하는 방법이 필요함

소프트웨어 구현 과정
* 개발 환경 준비(인프라)
* 개발(분석/설계/개발)
* 개발지원 과정(빌드/테스트/배포)

개발 환경은 클라우드 인프라 활용하면 쉽게 배포 가능
개발 완료가 되면 빌드, 테스트, 배포 와 같은 개발지원과정의 속도를 높이기 위한 가장 좋은 방법은 **자동화**
-> 소스코드 빌드 도기, 빌드와 동시에 테스트하는 도구, 인프라에 배포하는 도구 모두 필요

이러한 개발 환경, 개발지원 환경 자동화를 통틀어 인프라 자동화라고 하며 **인프라 자동화는 마이크로서비스 개발 과정의 필수조건**이 되어야 함

빌드/배포 파이프 라인은 '소스코드 빌드' -> '개발 환경 배포' -> '스테이징(staging) 환경 배포' -> '운영 환경 배포'로 구성되고 이 과정을 효율적으로 관리하고 자동화 해야함

**Infrastructure as Code** : 코드를 이용해 인프라 구성부터 빌드, 배포를 정의하는 것을 의미
-> 이를 통해 인프라 효율적 관리(리소스 설정, 복제, 공유 등)

### 1.3.5 저장소의 변화: 통합 저장소가 아닌 분권 데이터 관리
마이크로서비스에선 폴리글랏 저장소(polyglot persistence) 접근법을 선택하여 서비스 별로 데이터베이스를 가짐
또한, 서비스가 독립적이기에 API를 통해서만 접근해야 함
-> 비즈니스 처리를 위해 일부 데이터 복제와 중복 허용이 필요할 때, 데이터 일관성 문제가 발생함

보통 2단계 커밋(two-phase commit) 분산 트랜잭션 기법을 사용하는데, 이는 독립성 침해되고 기능을 지원하지 않을 수 있음

마이크로서비스는 **비동기 이벤트 처리**를 통한 협업을 강조함
결과적 일관성(Eventual Consistency)으로 서비스 간 데이터 불일치가 발생할 수 있지만 결과적으론 같아진 다는 것

### 1.3.6 위기 대응 방식의 변화: 실패를 고려한 설계
시스템은 언제나 실패할 수 있고 이를 자연스럽게 대응할 수 있도록 설계해야함, 이러한 성격을 내결함성(fault tolereance)

완벽을 추구한 시스템이 아닌 실패에 빠르게 대응할 수 있는 시스템이 더 쉽고 효율적임

이러한 실패를 대응하기 위해 모니터링 하는 체계도 필요함
