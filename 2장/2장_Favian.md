# 2장 : MSA의 이해

## 2.1 : 리액티브 선언 : 현대 애플리케이션이 갖춰야 할 바람직한 속성들

리액티브 시스템을 만들기 위한 요소

- **응답성** : 사용자에게 신뢰성 있는 응답을 빠르고 적절하게 제공하는 것


- **탄력성** : 장애가 발생하거나 부분적으로 고장 나더라도 시스템 전체가 고장 나지 않고 빠르게 복구하는 능력


- **유연성** : 시스템의 사용량에 변화가 있더라도 균일한 응답성 제공, 시스템 사용량에 비례해서 자원을 늘리거나 줄이는 능력


- **메시지 기반** : 비동기 메시지 전달을 통해 위치 투명성, 느슨한 결합, 논블로킹 통신을 지향하는 것

리액티브 시스템이 반드시 갖춰야 할 공통적인 특성 : **아키텍처 유연성**

> 시스템을 구성하는 구성요소 간의 관계들이 느슨하게 맺어져 있어 언제든지 대체되거나 추가 확장될 수 있는 특성

## 2.2 : 강 결합에서 느슨한 결합의 아키텍처로의 변화

예전에는 아키텍처의 구성요소들을 각 기업이나 특정 벤더의 제품에 전적으로 의존해서 구축했다

특정 벤더의 제품에 수정이 필요한 부분이 있다면 개발을 하고, 해당 벤더의 프레임워크가 변경된다면 의존하는 애플리케이션 또한 변경해야 했다

이에 따라 쉽게 변경하거나 확장하지 못한다는 단점이 따라온다

최근에는 클라우드 환경하에서 필요한 영역에 적절한 솔루션을 선택하고 조합하는 개방적인 방식으로 바뀌고 있다

## 2.3 : 마이크로서비스의 외부 아키텍처와 내부 아키텍처

마이크로서비스 아키텍처는 인프라, 플랫폼, 애플리케이션으로 구분된다

- 외부 아키텍처 : 인프라, 플랫폼, 애플리케이션 영역에 있는 구성요소 및 관계를 정의하는 것

- 내부 아키텍처 : 마이크로서비스가 제공하는 API, 비즈니스 로직, 이벤트 발행, 데이터 저장 처리 등 구조화에 대한 내용

## 2.4 : MSA 구성요소 및 MSA 패턴

인프라 구성요소 : 마이크로서비스를 지탱하는 하부구조 인프라를 구축하는 데 필요한 구성요소

플랫폼 패턴 : 인프라 위에서 마이크로서비스의 운영과 관리를 지원하는 플랫폼 차원의 패턴

애플리케이션 패턴 : 마이크로서비스 애클리케이션을 구성하는 데 필요한 패턴

### 인프라 구성요소

#### 퍼블릭 클라우드와 베어 메탈, 프라이빗 클라우드 환경

맨 하부의 시스템의 기반이 되는 인프라를 구축해야 한다

물리적인 베어 메탈 장비를 구매 ?  가상화 환경을 선택 ?

마이크로서비스는 어떠한 환경에서도 유연하도록 구성돼야 하므로 특정 인프라를 고집하지 않는다

베어 메탈을 고려한다면 프라이빗 클라우드 환경을 구축하는 것을 의미한다

#### VM과 컨테이너

가상 머신에서는 운영체제 패치 설치나 관련 라이브러리 설치 같은 오버헤드가 지속적으로 발생

마이크로서비스 같은 작은 서비스를 패키지하고 배포하기에는 컨테이너 환경이 더 적합

**도커 컨테이너의 이점**

- **이식성** : 어떠한 호스트 커널이나 플랫폼 버전에 상관없이 사용 가능하며 동일하게 동작

- **신속성** : 크기가 작고 가볍기 때문에 빠르게 배포 가능, 문제 발생 시 수정할 필요 없이 새로 가동

- **재사용성** : 동일한 환경을 재사용해서 쉽게 설정 가능하기 때문에 개발, 테스트, 스테이징, 프로덕트 환경을 동일한 환경으로 구축

#### 컨테이너 오케스트레이션

컨테이너를 관리하기 위한 기술

> 자동 배치 및 복제, 장애 복구, 확장 및 축소, 컨테이너 간 통신, 로드 밸런싱 등

이러한 기술을 컨테이너 오케스트레이션이라 한다

대표적으로 쿠버네티스가 있다

- **자동화된 자원 배정** : 각 컨테이너가 필요로 하는 CPU 와 메모리를 쿠버네티스에 요청하면 컨테이너를 노드에 맞춰 자동으로 배치 

- **셀프 치유** : 컨테이너의 이상 유무를 점검해서 실패한 경우 자동으로 교체하고 재스케줄링

- **수평 확장** : 일정 CPU 및 메모리 사용량을 초과하면 자동으로 확장

### 마이크로서비스 운영과 관리를 위한 플랫폼 패턴

#### 개발 지원 환경 : 데브옵스 인프라 구성

기존에는 수동으로 테스트, 오류 수정, 스테이징 환경 배포 등등 시간이 엄청 오래 걸렸다

- 데브옵스 : 개발과 운영을 병행 가능하게끔 높은 품질로 소프트웨어를 빠르게 개발하도록 지원하는 빌드, 테스트, 배포를 위한 자동화 환경

- CI : 자동으로 통합하고 테스트하고 리포트로 남기는 활동

- CD : 실행 환경에 자동으로 배포하는 것 

#### 빌드/배포 파이프라인 설계

빌드/배포 파이프라인 : 빌드/배포되는 과정 동안 수행해야 할 태스크가 정의된 것

> 레포지토리 - 빌드&유닛 테스트 - 정적 분석 - 통합 테스트 - 배포 - 마이크로서비스

클라우드 같은 가상환경이 대중화 되면서 완전한 자동화 가능해졌다

하지만, 모든 과정을 자동화하는 과정은 매우 힘든 작업이기에 일부는 자동화, 일부는 수동화 처리할 수도 있다

애플리케이션마다 빌드/배포 파이프라인 또한 다르게 설정할 수 있다

#### 스프링 클라우드 : 스프링 부트 + 넷플릭스 OSS

1. 모든 마이크로서비스는 인프라에 종속되지 않도록 데이터베이스, 파일 등에 저장된 환경 설정 설정 정보를 형상관리 시스템에 연계된 'Config 서비스' 에서 가져와 설정 정보를 주입한 후 클라우드 인프라의 개별 인스턴스로 로딩
2. 로딩과 동시에 '서비스 레지스트리'에 자신의 서비스명과 클라우드 인프라부터 할당받은 물리 주소를 매핑해서 등록
3. 클라이언트가 'API 게이트웨이'를 통해 마이크로서비스에 접근하고, 이때 API 게이트웨이는 적절한 라우팅 및 부하 관리를 위한 로드 밸런싱을 수행한다
4. 또한 API 게이트웨이에서 클라이언트가 마이크로서비스에 접근하기 위한 주소를 알기 위해 '서비스 레지스트리' 검색을 통해 서비스의 위치를 가져온다
5. 동시에 API 게이트웨이는 클라이언트가 각 서비스에 접근할 수 있는 권한이 있는지 '권한 서비스'와 연계해 인증/인가 처리를 수행한다
6. 이러한 모든 마이크로서비스 간의 호출 흐름은 '모니터링 서비스'와 '추적 서비스'에 의해 모니터링되고 추적된다








